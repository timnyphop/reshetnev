import { Directive, inject, Input } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { WA_WINDOW } from '@ng-web-apis/common';
import { tuiInjectElement } from '@taiga-ui/cdk/utils/dom';
import { tuiClamp } from '@taiga-ui/cdk/utils/math';
import { map } from 'rxjs';
import { TUI_SHEET, TUI_SHEET_SCROLL } from '../../sheet-tokens';
import * as i0 from "@angular/core";
// So that borders get rounded when image is visible for at least 10px
const OFFSET = 10;
class TuiSheetTopDirective {
    constructor() {
        this.scroll$ = inject(TUI_SHEET_SCROLL);
        this.component = inject(TUI_SHEET);
        this.win = inject(WA_WINDOW);
        this.el = tuiInjectElement();
        this.rounded$ = this.scroll$
            .pipe(map((y) => y < this.stop + OFFSET))
            .pipe(takeUntilDestroyed())
            .subscribe((add) => add
            ? this.el.classList.add('_rounded')
            : this.el.classList.remove('_rounded'));
        this.transform$ = this.scroll$
            .pipe(map((y) => `translateY(${this.getY(y)}%) scaleX(-1)`), takeUntilDestroyed())
            .subscribe((transform) => this.el.style.setProperty('transform', transform));
        this.clickthrough$ = this.scroll$
            .pipe(map((y) => !!Math.round(this.getY(y))), takeUntilDestroyed())
            .subscribe((add) => add
            ? this.el.classList.add('_clickthrough')
            : this.el.classList.remove('_clickthrough'));
        this.stop = 0;
    }
    getY(scrollTop) {
        const value = scrollTop - this.stop;
        const total = this.win.innerHeight - this.component.item.offset - this.stop;
        return this.stop && tuiClamp(100 - (value / total) * 100, 0, 100);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiSheetTopDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.2.12", type: TuiSheetTopDirective, selector: "[tuiSheetTop]", inputs: { stop: ["tuiSheetTop", "stop"] }, ngImport: i0 }); }
}
export { TuiSheetTopDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiSheetTopDirective, decorators: [{
            type: Directive,
            args: [{
                    standalone: false,
                    selector: '[tuiSheetTop]',
                }]
        }], propDecorators: { stop: [{
                type: Input,
                args: ['tuiSheetTop']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlZXQtdG9wLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xlZ2FjeS9jb21wb25lbnRzL3NoZWV0L2RpcmVjdGl2ZXMvc2hlZXQtdG9wL3NoZWV0LXRvcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3ZELE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQzlELE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUM5QyxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUN6RCxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDbEQsT0FBTyxFQUFDLEdBQUcsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUV6QixPQUFPLEVBQUMsU0FBUyxFQUFFLGdCQUFnQixFQUFDLE1BQU0sb0JBQW9CLENBQUM7O0FBRS9ELHNFQUFzRTtBQUN0RSxNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFFbEIsTUFJYSxvQkFBb0I7SUFKakM7UUFLcUIsWUFBTyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ25DLGNBQVMsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDOUIsUUFBRyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN4QixPQUFFLEdBQUcsZ0JBQWdCLEVBQUUsQ0FBQztRQUV0QixhQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU87YUFDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLENBQUM7YUFDeEMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7YUFDMUIsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FDZixHQUFHO1lBQ0MsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7WUFDbkMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FDN0MsQ0FBQztRQUVhLGVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTzthQUN2QyxJQUFJLENBQ0QsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxFQUNyRCxrQkFBa0IsRUFBRSxDQUN2QjthQUNBLFNBQVMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBRTlELGtCQUFhLEdBQUcsSUFBSSxDQUFDLE9BQU87YUFDMUMsSUFBSSxDQUNELEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQ3RDLGtCQUFrQixFQUFFLENBQ3ZCO2FBQ0EsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FDZixHQUFHO1lBQ0MsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUM7WUFDeEMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FDbEQsQ0FBQztRQUdDLFNBQUksR0FBRyxDQUFDLENBQUM7S0FRbkI7SUFOVyxJQUFJLENBQUMsU0FBaUI7UUFDMUIsTUFBTSxLQUFLLEdBQUcsU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDcEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFNUUsT0FBTyxJQUFJLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN0RSxDQUFDOytHQXpDUSxvQkFBb0I7bUdBQXBCLG9CQUFvQjs7U0FBcEIsb0JBQW9COzRGQUFwQixvQkFBb0I7a0JBSmhDLFNBQVM7bUJBQUM7b0JBQ1AsVUFBVSxFQUFFLEtBQUs7b0JBQ2pCLFFBQVEsRUFBRSxlQUFlO2lCQUM1Qjs4QkFtQ1UsSUFBSTtzQkFEVixLQUFLO3VCQUFDLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RpcmVjdGl2ZSwgaW5qZWN0LCBJbnB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge3Rha2VVbnRpbERlc3Ryb3llZH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuaW1wb3J0IHtXQV9XSU5ET1d9IGZyb20gJ0BuZy13ZWItYXBpcy9jb21tb24nO1xuaW1wb3J0IHt0dWlJbmplY3RFbGVtZW50fSBmcm9tICdAdGFpZ2EtdWkvY2RrL3V0aWxzL2RvbSc7XG5pbXBvcnQge3R1aUNsYW1wfSBmcm9tICdAdGFpZ2EtdWkvY2RrL3V0aWxzL21hdGgnO1xuaW1wb3J0IHttYXB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQge1RVSV9TSEVFVCwgVFVJX1NIRUVUX1NDUk9MTH0gZnJvbSAnLi4vLi4vc2hlZXQtdG9rZW5zJztcblxuLy8gU28gdGhhdCBib3JkZXJzIGdldCByb3VuZGVkIHdoZW4gaW1hZ2UgaXMgdmlzaWJsZSBmb3IgYXQgbGVhc3QgMTBweFxuY29uc3QgT0ZGU0VUID0gMTA7XG5cbkBEaXJlY3RpdmUoe1xuICAgIHN0YW5kYWxvbmU6IGZhbHNlLFxuICAgIHNlbGVjdG9yOiAnW3R1aVNoZWV0VG9wXScsXG59KVxuZXhwb3J0IGNsYXNzIFR1aVNoZWV0VG9wRGlyZWN0aXZlIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNjcm9sbCQgPSBpbmplY3QoVFVJX1NIRUVUX1NDUk9MTCk7XG4gICAgcHJpdmF0ZSByZWFkb25seSBjb21wb25lbnQgPSBpbmplY3QoVFVJX1NIRUVUKTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHdpbiA9IGluamVjdChXQV9XSU5ET1cpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgZWwgPSB0dWlJbmplY3RFbGVtZW50KCk7XG5cbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgcm91bmRlZCQgPSB0aGlzLnNjcm9sbCRcbiAgICAgICAgLnBpcGUobWFwKCh5KSA9PiB5IDwgdGhpcy5zdG9wICsgT0ZGU0VUKSlcbiAgICAgICAgLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKCkpXG4gICAgICAgIC5zdWJzY3JpYmUoKGFkZCkgPT5cbiAgICAgICAgICAgIGFkZFxuICAgICAgICAgICAgICAgID8gdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdfcm91bmRlZCcpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ19yb3VuZGVkJyksXG4gICAgICAgICk7XG5cbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgdHJhbnNmb3JtJCA9IHRoaXMuc2Nyb2xsJFxuICAgICAgICAucGlwZShcbiAgICAgICAgICAgIG1hcCgoeSkgPT4gYHRyYW5zbGF0ZVkoJHt0aGlzLmdldFkoeSl9JSkgc2NhbGVYKC0xKWApLFxuICAgICAgICAgICAgdGFrZVVudGlsRGVzdHJveWVkKCksXG4gICAgICAgIClcbiAgICAgICAgLnN1YnNjcmliZSgodHJhbnNmb3JtKSA9PiB0aGlzLmVsLnN0eWxlLnNldFByb3BlcnR5KCd0cmFuc2Zvcm0nLCB0cmFuc2Zvcm0pKTtcblxuICAgIHByb3RlY3RlZCByZWFkb25seSBjbGlja3Rocm91Z2gkID0gdGhpcy5zY3JvbGwkXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgICAgbWFwKCh5KSA9PiAhIU1hdGgucm91bmQodGhpcy5nZXRZKHkpKSksXG4gICAgICAgICAgICB0YWtlVW50aWxEZXN0cm95ZWQoKSxcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKChhZGQpID0+XG4gICAgICAgICAgICBhZGRcbiAgICAgICAgICAgICAgICA/IHRoaXMuZWwuY2xhc3NMaXN0LmFkZCgnX2NsaWNrdGhyb3VnaCcpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmVsLmNsYXNzTGlzdC5yZW1vdmUoJ19jbGlja3Rocm91Z2gnKSxcbiAgICAgICAgKTtcblxuICAgIEBJbnB1dCgndHVpU2hlZXRUb3AnKVxuICAgIHB1YmxpYyBzdG9wID0gMDtcblxuICAgIHByaXZhdGUgZ2V0WShzY3JvbGxUb3A6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gc2Nyb2xsVG9wIC0gdGhpcy5zdG9wO1xuICAgICAgICBjb25zdCB0b3RhbCA9IHRoaXMud2luLmlubmVySGVpZ2h0IC0gdGhpcy5jb21wb25lbnQuaXRlbS5vZmZzZXQgLSB0aGlzLnN0b3A7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcCAmJiB0dWlDbGFtcCgxMDAgLSAodmFsdWUgLyB0b3RhbCkgKiAxMDAsIDAsIDEwMCk7XG4gICAgfVxufVxuIl19