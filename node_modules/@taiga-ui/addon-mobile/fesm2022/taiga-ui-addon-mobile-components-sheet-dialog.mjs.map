{"version":3,"file":"taiga-ui-addon-mobile-components-sheet-dialog.mjs","sources":["../../../projects/addon-mobile/components/sheet-dialog/sheet-dialog.component.ts","../../../projects/addon-mobile/components/sheet-dialog/sheet-dialog.template.html","../../../projects/addon-mobile/components/sheet-dialog/sheet-dialog.options.ts","../../../projects/addon-mobile/components/sheet-dialog/sheet-dialog.service.ts","../../../projects/addon-mobile/components/sheet-dialog/sheet-dialog.directive.ts","../../../projects/addon-mobile/components/sheet-dialog/taiga-ui-addon-mobile-components-sheet-dialog.ts"],"sourcesContent":["import {AsyncPipe, NgForOf, NgIf} from '@angular/common';\nimport type {AfterViewInit, ElementRef, QueryList} from '@angular/core';\nimport {\n    ChangeDetectionStrategy,\n    Component,\n    inject,\n    ViewChild,\n    ViewChildren,\n} from '@angular/core';\nimport {takeUntilDestroyed} from '@angular/core/rxjs-interop';\nimport {EMPTY_QUERY} from '@taiga-ui/cdk/constants';\nimport {TuiClickOutside} from '@taiga-ui/cdk/directives/click-outside';\nimport type {TuiPopover} from '@taiga-ui/cdk/services';\nimport {tuiInjectElement} from '@taiga-ui/cdk/utils/dom';\nimport {tuiPure} from '@taiga-ui/cdk/utils/miscellaneous';\nimport {tuiSlideInTop} from '@taiga-ui/core/animations';\nimport {TuiButton} from '@taiga-ui/core/components/button';\nimport {\n    TUI_ANIMATIONS_SPEED,\n    TUI_CLOSE_WORD,\n    TUI_COMMON_ICONS,\n} from '@taiga-ui/core/tokens';\nimport {tuiGetDuration} from '@taiga-ui/core/utils/miscellaneous';\nimport {shouldCall} from '@taiga-ui/event-plugins';\nimport {\n    POLYMORPHEUS_CONTEXT,\n    PolymorpheusOutlet,\n    PolymorpheusTemplate,\n} from '@taiga-ui/polymorpheus';\nimport {BehaviorSubject} from 'rxjs';\n\nimport type {TuiSheetDialogOptions} from './sheet-dialog.options';\n\n// So we re-enter ngZone and trigger change detection\nfunction isCloseable(this: TuiSheetDialogComponent<unknown>): boolean {\n    return this.context.closeable;\n}\n\n@Component({\n    standalone: true,\n    selector: 'tui-sheet-dialog',\n    imports: [\n        NgForOf,\n        TuiClickOutside,\n        NgIf,\n        PolymorpheusOutlet,\n        PolymorpheusTemplate,\n        TuiButton,\n        AsyncPipe,\n    ],\n    templateUrl: './sheet-dialog.template.html',\n    styleUrls: ['./sheet-dialog.style.less'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    animations: [tuiSlideInTop],\n    host: {\n        '[@tuiSlideInTop]': 'slideInTop',\n        '[style.top.px]': 'offset',\n        '[class._closeable]': 'closeable',\n        '(document:touchstart.passive.silent)': 'onPointerChange(1)',\n        '(document:touchend.silent)': 'onPointerChange(-1)',\n        '(document:touchcancel.silent)': 'onPointerChange(-1)',\n        '(scroll.silent)': 'onPointerChange(0)',\n    },\n})\nexport class TuiSheetDialogComponent<I> implements AfterViewInit {\n    @ViewChild('sheet')\n    private readonly sheet?: ElementRef<HTMLElement>;\n\n    @ViewChildren('stops')\n    private readonly stopsRefs: QueryList<ElementRef<HTMLElement>> = EMPTY_QUERY;\n\n    private readonly el = tuiInjectElement();\n    private readonly speed = inject(TUI_ANIMATIONS_SPEED);\n\n    private pointers = 0;\n\n    protected readonly slideInTop = {\n        value: '',\n        params: {\n            start: '100vh',\n            duration: tuiGetDuration(this.speed),\n        },\n    };\n\n    protected readonly stuck$ = new BehaviorSubject(false);\n\n    protected readonly stuck$$ = this.stuck$\n        .pipe(takeUntilDestroyed())\n        .subscribe((add) =>\n            add ? this.el.classList.add('_stuck') : this.el.classList.remove('_stuck'),\n        );\n\n    protected readonly icons = inject(TUI_COMMON_ICONS);\n    protected readonly closeWord$ = inject(TUI_CLOSE_WORD);\n    protected readonly context =\n        inject<TuiPopover<TuiSheetDialogOptions<I>, any>>(POLYMORPHEUS_CONTEXT);\n\n    public ngAfterViewInit(): void {\n        this.el.scrollTop =\n            [...this.getStops(this.stopsRefs), this.sheetTop][this.context.initial] ?? 0;\n    }\n\n    protected get offset(): number {\n        return this.context.offset;\n    }\n\n    protected get closeable(): boolean {\n        return this.context.closeable;\n    }\n\n    protected get isSmall(): boolean {\n        return this.sheetTop > (this.sheet?.nativeElement.clientHeight || Infinity);\n    }\n\n    @shouldCall(isCloseable)\n    protected close(): void {\n        // TODO: Refactor focus visible on mobile\n        this.el.dispatchEvent(new Event('mousedown', {bubbles: true}));\n        this.context.$implicit.complete();\n    }\n\n    protected onPointerChange(delta: number): void {\n        this.pointers += delta;\n\n        if (!delta) {\n            const stuck = this.el.scrollTop > this.sheetTop;\n\n            this.stuck$.value !== stuck && this.stuck$.next(stuck);\n        }\n\n        if (this.context.closeable && !this.pointers && !this.el.scrollTop) {\n            this.close();\n        }\n    }\n\n    private get sheetTop(): number {\n        return this.sheet?.nativeElement.offsetTop ?? Infinity;\n    }\n\n    @tuiPure\n    private getStops(stops: QueryList<ElementRef<HTMLElement>>): readonly number[] {\n        return stops.map(\n            ({nativeElement}) => nativeElement.offsetTop + nativeElement.clientHeight,\n        );\n    }\n}\n","<div class=\"t-stops\">\n    <div\n        *ngFor=\"let stop of context.stops\"\n        #stops\n        class=\"t-stop\"\n        [style.margin-top]=\"stop\"\n    ></div>\n</div>\n<div\n    #sheet\n    class=\"t-sheet\"\n    [class.t-sheet_small]=\"isSmall\"\n    (tuiClickOutside)=\"close()\"\n>\n    <div class=\"t-top\"></div>\n    <h2\n        *ngIf=\"context.label\"\n        class=\"t-heading\"\n        [id]=\"context.id\"\n    >\n        <ng-container *polymorpheusOutlet=\"context.label as label\">\n            {{ label }}\n        </ng-container>\n        <button\n            *ngIf=\"context.closeable\"\n            appearance=\"icon\"\n            size=\"xs\"\n            tuiIconButton\n            class=\"t-close\"\n            [iconStart]=\"icons.close\"\n            (click)=\"close()\"\n        >\n            {{ closeWord$ | async }}\n        </button>\n    </h2>\n    <div\n        *ngIf=\"context.content\"\n        class=\"t-content\"\n    >\n        <ng-container *polymorpheusOutlet=\"context.content as text; context: context\">\n            {{ text }}\n        </ng-container>\n    </div>\n</div>\n<div class=\"t-footer\"></div>\n","import type {Provider} from '@angular/core';\nimport {tuiCreateToken, tuiProvideOptions} from '@taiga-ui/cdk/utils/miscellaneous';\nimport type {PolymorpheusContent} from '@taiga-ui/polymorpheus';\n\nexport interface TuiSheetDialogOptions<I = undefined> {\n    readonly closeable: boolean;\n    readonly data: I;\n    readonly initial: number;\n    readonly label: PolymorpheusContent;\n    readonly offset: number;\n    readonly stops: readonly string[];\n}\n\nexport const TUI_SHEET_DIALOG_DEFAULT_OPTIONS: TuiSheetDialogOptions = {\n    label: '',\n    stops: [],\n    initial: 0,\n    offset: 16,\n    closeable: true,\n    data: undefined,\n};\n\n/**\n * Default parameters for mobile dialog component\n */\nexport const TUI_SHEET_DIALOG_OPTIONS = tuiCreateToken(TUI_SHEET_DIALOG_DEFAULT_OPTIONS);\n\nexport function tuiSheetDialogOptionsProvider(\n    options: Partial<TuiSheetDialogOptions>,\n): Provider {\n    return tuiProvideOptions(\n        TUI_SHEET_DIALOG_OPTIONS,\n        options,\n        TUI_SHEET_DIALOG_DEFAULT_OPTIONS,\n    );\n}\n","import {inject, Injectable} from '@angular/core';\nimport {TuiPopoverService} from '@taiga-ui/cdk/services';\nimport {TUI_DIALOGS} from '@taiga-ui/core/components/dialog';\n\nimport {TuiSheetDialogComponent} from './sheet-dialog.component';\nimport type {TuiSheetDialogOptions} from './sheet-dialog.options';\nimport {TUI_SHEET_DIALOG_OPTIONS} from './sheet-dialog.options';\n\n@Injectable({\n    providedIn: 'root',\n    useFactory: () =>\n        new TuiSheetDialogService(\n            TUI_DIALOGS,\n            TuiSheetDialogComponent,\n            inject(TUI_SHEET_DIALOG_OPTIONS),\n        ),\n})\nexport class TuiSheetDialogService extends TuiPopoverService<\n    TuiSheetDialogOptions<any>\n> {}\n","import {Directive} from '@angular/core';\nimport {TuiPopoverDirective} from '@taiga-ui/cdk/directives/popover';\nimport {tuiAsPopover} from '@taiga-ui/cdk/services';\n\nimport type {TuiSheetDialogOptions} from './sheet-dialog.options';\nimport {TuiSheetDialogService} from './sheet-dialog.service';\n\n@Directive({\n    standalone: true,\n    selector: 'ng-template[tuiSheetDialog]',\n    inputs: ['options: tuiSheetDialogOptions', 'open: tuiSheetDialog'],\n    outputs: ['openChange: tuiSheetDialogChange'],\n    providers: [tuiAsPopover(TuiSheetDialogService)],\n})\nexport class TuiSheetDialog extends TuiPopoverDirective<TuiSheetDialogOptions> {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}