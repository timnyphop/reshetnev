{"version":3,"file":"taiga-ui-kit-directives-highlight.mjs","sources":["../../../projects/kit/directives/highlight/highlight.directive.ts","../../../projects/kit/directives/highlight/taiga-ui-kit-directives-highlight.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport type {OnChanges} from '@angular/core';\nimport {Directive, inject, Input, Renderer2} from '@angular/core';\nimport {takeUntilDestroyed} from '@angular/core/rxjs-interop';\nimport {ResizeObserverService} from '@ng-web-apis/resize-observer';\nimport {svgNodeFilter} from '@taiga-ui/cdk/constants';\nimport {tuiInjectElement} from '@taiga-ui/cdk/utils/dom';\nimport {tuiPx} from '@taiga-ui/cdk/utils/miscellaneous';\n\n@Directive({\n    standalone: true,\n    selector: '[tuiHighlight]',\n    providers: [ResizeObserverService],\n    host: {\n        '[style.position]': '\"relative\"',\n        '[style.zIndex]': '0',\n    },\n})\nexport class TuiHighlight implements OnChanges {\n    private readonly el = tuiInjectElement();\n    private readonly renderer = inject(Renderer2);\n    private readonly doc = inject(DOCUMENT);\n    private readonly highlight: HTMLElement = this.setUpHighlight();\n    private readonly treeWalker = this.doc.createTreeWalker(\n        this.el,\n        NodeFilter.SHOW_TEXT,\n        svgNodeFilter,\n    );\n\n    @Input()\n    public tuiHighlight = '';\n\n    @Input()\n    public tuiHighlightColor = 'var(--tui-service-selection-background)';\n\n    constructor() {\n        inject(ResizeObserverService, {self: true})\n            .pipe(takeUntilDestroyed())\n            .subscribe(() => this.updateStyles());\n    }\n\n    public ngOnChanges(): void {\n        this.updateStyles();\n    }\n\n    protected get match(): boolean {\n        return this.indexOf(this.el.textContent) !== -1;\n    }\n\n    private updateStyles(): void {\n        this.highlight.style.display = 'none';\n\n        if (!this.match) {\n            return;\n        }\n\n        this.treeWalker.currentNode = this.el;\n\n        do {\n            const index = this.indexOf(this.treeWalker.currentNode.nodeValue);\n\n            if (index === -1) {\n                continue;\n            }\n\n            const range = this.doc.createRange();\n\n            range.setStart(this.treeWalker.currentNode, index);\n            range.setEnd(this.treeWalker.currentNode, index + this.tuiHighlight.length);\n\n            const hostRect = this.el.getBoundingClientRect();\n            const {left, top, width, height} = range.getBoundingClientRect();\n            const {style} = this.highlight;\n\n            style.background = this.tuiHighlightColor;\n            style.left = tuiPx(left - hostRect.left);\n            style.top = tuiPx(top - hostRect.top);\n            style.width = tuiPx(width);\n            style.height = tuiPx(height);\n            style.display = 'block';\n\n            return;\n        } while (this.treeWalker.nextNode());\n    }\n\n    private indexOf(source: string | null): number {\n        return !source || !this.tuiHighlight\n            ? -1\n            : source.toLowerCase().indexOf(this.tuiHighlight.toLowerCase());\n    }\n\n    private setUpHighlight(): HTMLElement {\n        const highlight = this.renderer.createElement('div');\n        const {style} = highlight;\n\n        style.background = this.tuiHighlightColor;\n        style.zIndex = '-1';\n        style.position = 'absolute';\n        this.renderer.appendChild(this.el, highlight);\n\n        return highlight;\n    }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}